<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="{{ url_for('static', filename='health.css') }}">
<title>Health Dashboard</title>
</head>

<body>
<div class="health-container">

  <!-- Top Navigation -->
  <div class="nav-icons">
    {% include "_top_nav.html" %}
  </div>

  <!-- Header -->
  <div class="health-header">
    <h2>ğŸ’š Health Dashboard</h2>
    <input type="date" id="health-date">
  </div>

  <!-- Habit Summary -->
  <div class="habit-summary">

    <div class="habit-circle-wrapper">
      <div class="habit-circle">
        <svg width="120" height="120">
          <circle cx="60" cy="60" r="50"
                  stroke="#e5e7eb"
                  stroke-width="10"
                  fill="none"/>
          <circle cx="60" cy="60" r="50"
                  stroke="#2563eb"
                  stroke-width="10"
                  fill="none"
                  stroke-dasharray="314"
                  stroke-dashoffset="{{ 314 - (habit_percent * 3.14) }}"
                  transform="rotate(-90 60 60)"/>
        </svg>
        <div class="circle-text">{{ habit_percent }}%</div>
      </div>

      <div class="weekly-line" id="weeklyAvg"></div>
      <div id="bestHabit" class="best-habit"></div>
    </div>

    <div class="streak-badge" id="streak-badge">
      ğŸ”¥ {{ health_streak }} day streak
    </div>

  </div>

  <!-- Main Grid -->
  <div class="health-grid">

    <!-- Metrics Card -->
    <div class="health-card">

      <label>Weight (kg)</label>
      <input type="number" id="weight" step="0.1">

      <label>Sleep (hours)</label>
      <input type="number" id="sleep" step="0.5">

      <label>Mood</label>
      <select id="mood">
        <option>ğŸ˜Š Happy</option>
        <option>ğŸ˜ Neutral</option>
        <option>ğŸ˜ Low</option>
      </select>

      <label>Energy (1â€“10)</label>
      <input type="range" id="energy" min="1" max="10">

      <label>Notes</label>
      <textarea id="health-notes"></textarea>

      <h4>Daily Habits</h4>

      <!-- âœ… Correct container -->
      <div id="habitContainer" class="sortable-habits">

        {% for habit in habit_list %}
        <div class="habit-item" data-id="{{ habit.id }}">

          <div class="habit-edit-row">
            <input value="{{ habit.name }}"
                   data-id="{{ habit.id }}"
                   class="habit-name-edit">

            <input value="{{ habit.unit }}"
                   data-id="{{ habit.id }}"
                   class="habit-unit-edit">

            <input type="number"
                   step="0.1"
                   value="{{ habit.goal or 0 }}"
                   data-id="{{ habit.id }}"
                   class="habit-goal-edit"
                   placeholder="Goal">

            <button onclick="showHabitChart('{{ habit.id }}')">ğŸ“ˆ</button>
            <button onclick="deleteHabit('{{ habit.id }}')">ğŸ—‘</button>
          </div>

          <input type="number"
                 step="0.1"
                 value="{{ habit.value }}"
                 data-id="{{ habit.id }}"
                 class="habit-input">

        </div>
        {% endfor %}

      </div>

    <div class="add-habit-section">
      <input id="newHabitName" placeholder="Habit name">
      <input id="newHabitUnit" placeholder="Unit (mins, hrs)">
      <button onclick="addHabit()">Add Habit</button>
    </div>

    <button id="saveBtn" onclick="saveHealth()">Save</button>

    </div>

    <!-- Chart + Monthly Summary -->
    <div class="health-card">
      <canvas id="healthChart"></canvas>

      <h4>ğŸ“… Monthly Summary</h4>
      <div id="monthlySummary"></div>
    </div>

    <!-- Heatmap -->
    <div class="health-card">
      <h4>ğŸ“Š Activity Heatmap</h4>
      <div id="heatmap"></div>
    </div>

  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script src="{{ url_for('static', filename='health.js') }}" defer></script>

</body>
</html>