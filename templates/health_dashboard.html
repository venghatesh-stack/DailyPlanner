<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{{ url_for('static', filename='health.css') }}">
  <title>Health Dashboard</title>
</head>

<body>

  <div class="health-container">

    <!-- Top Navigation -->
    <div class="nav-icons">
      {% include "_top_nav.html" %}
    </div>

    <!-- Header -->
    <div class="health-header">
      <h2>ğŸ’š Health Dashboard</h2>
      <input type="date" id="health-date">
    </div>

    <!-- Habit Summary -->
    <div class="habit-summary">

      <div class="habit-circle-wrapper">
        <div class="health-score-card">

          <div class="health-score-ring">
            <svg width="120" height="120">
              <circle cx="60" cy="60" r="50" stroke="#e5e7eb" stroke-width="10" fill="none" />

              <circle id="scoreRing" cx="60" cy="60" r="50" stroke="#22c55e" stroke-width="10" fill="none"
                stroke-linecap="round" transform="rotate(-90 60 60)" />
            </svg>

            <div id="healthScoreNumber" class="score-number">0</div>
          </div>

          <div class="score-label">
            Daily Health Score
          </div>

        </div>
        <div class="habit-circle">
          <svg width="120" height="120">
            <circle cx="60" cy="60" r="50" stroke="#e5e7eb" stroke-width="10" fill="none" />

            <circle cx="60" cy="60" r="50" stroke="#2563eb" stroke-width="10" fill="none" stroke-dasharray="314"
              stroke-dashoffset="{{ 314 - (habit_percent * 3.14) }}" transform="rotate(-90 60 60)" />
          </svg>

          <div class="circle-text">{{ habit_percent }}%</div>
        </div>

        <!-- NEW Sparkline -->
        <div class="weight-sparkline">
          <canvas id="weightSparkline"></canvas>
        </div>

        <div class="weekly-line" id="weeklyAvg"></div>
        <div id="bestHabit" class="best-habit"></div>

      </div>

      <div class="streak-badge" id="streak-badge">
        ğŸ”¥ {{ health_streak }} day streak
      </div>

    </div>

    <!-- Main Grid -->
    <div class="health-grid">

      <div class="health-card">

        <div class="metrics-header">
          <h4>Health Metrics</h4>

          <button id="saveBtn" class="icon-save" onclick="saveHealth()">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
              <path d="M17 3H5a2 2 0 0 0-2 2v14l4-4h10a2 2 0 0 0 2-2V7l-2-4zM7 5h8v4H7V5z" />
            </svg>
          </button>
        </div>

     
        <h4>Weight Trend</h4>
        <canvas id="weightChart" height="80"></canvas>

        <!-- Habit Create Box -->
        <div class="habit-create-box">
          <h4>Enter Daily Habits</h4>

          <input id="newHabitName" placeholder="Habit name">
          <input id="newHabitUnit" placeholder="Unit (mins, hrs)">

          <button class="fab-add" onclick="openHabitSheet()">+</button>
        </div>

        <!-- Habit List -->
        <div id="habitContainer" class="sortable-habits">

          {% for habit in habit_list %}

          <div class="habit-item" data-id="{{ habit.id }}">

            <div class="habit-header">

              <div>
                <div class="habit-title">{{ habit.name }}</div>

                <div class="habit-sub">
                  Goal: {{ habit.goal }} {{ habit.unit }}
                </div>
              </div>

              <div class="habit-actions">
                <button class="habit-plus" onclick="event.stopPropagation(); quickAdd('{{ habit.id }}')">
                  +
                </button>
                <button onclick="event.stopPropagation(); toggleEdit('{{ habit.id }}')">âœï¸</button>
                <button onclick="event.stopPropagation(); showHabitChart('{{ habit.id }}')">ğŸ“ˆ</button>
                <button onclick="event.stopPropagation(); deleteHabit('{{ habit.id }}')">ğŸ—‘</button>
              </div>

            </div>

            <input type="number" step="0.1" value="{{ habit.value }}" data-id="{{ habit.id }}" class="habit-input"
              placeholder="Enter todayâ€™s value">

            <div class="habit-progress">
              <div class="habit-progress-fill" style="width: {{ habit.percent or 0 }}%">
              </div>
            </div>

            <div class="habit-edit-panel" id="edit-{{ habit.id }}">
              <input value="{{ habit.name }}" class="habit-name-edit" data-id="{{ habit.id }}">
              <input value="{{ habit.unit }}" class="habit-unit-edit" data-id="{{ habit.id }}">
              <input value="{{ habit.goal }}" class="habit-goal-edit" data-id="{{ habit.id }}">
            </div>

          </div>

          {% endfor %}

        </div>

        <!-- Mood / Energy / Notes -->
        <label>Mood</label>
        <select id="mood">
          <option>ğŸ˜Š Happy</option>
          <option>ğŸ˜ Neutral</option>
          <option>ğŸ˜ Low</option>
        </select>

        <label>Energy (1â€“10)</label>
        <input type="range" id="energy" min="1" max="10">

        <label>Notes</label>
        <textarea id="health-notes"></textarea>

      </div>

      <!-- Chart + Monthly Summary -->
      <div class="health-card">

        <canvas id="healthChart"></canvas>

        <h4>ğŸ“… Monthly Summary</h4>
        <div id="monthlySummary"></div>

      </div>

      <!-- Heatmap -->
      <div class="health-card">

        <h4>ğŸ“Š Activity Heatmap</h4>
        <div id="heatmap"></div>

      </div>

    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script src="{{ url_for('static', filename='health.js') }}" defer></script>
  <div id="toast-container"></div>
  <div id="saveToast">Saved âœ“</div>
  <!-- Habit Bottom Sheet -->
<div id="habitSheet" class="sheet-overlay">
  <div class="sheet">

    <div class="sheet-handle"></div>

    <div class="sheet-header">
      <h3>New Habit</h3>
      <button onclick="closeHabitSheet()">âœ•</button>
    </div>

    <div class="sheet-body">

      <!-- Emoji -->
      <div class="emoji-picker" id="emojiPicker">
        ğŸ˜€ ğŸ’ª ğŸš¶ ğŸ“š ğŸ§˜ ğŸƒ ğŸ¥— ğŸ’§ ğŸ’¤ ğŸ¯
      </div>

      <input type="text" id="sheetHabitName" placeholder="Habit name">

      <input type="text" id="sheetHabitUnit" placeholder="Unit (mins, steps, ml)">

      <input type="number" id="sheetHabitGoal" placeholder="Daily goal">

      <!-- Smart Suggestions -->
      <div class="goal-suggestions" id="goalSuggestions"></div>

      <!-- Color Picker -->
      <div class="color-picker">
        <div class="color-dot" data-color="#2563eb"></div>
        <div class="color-dot" data-color="#16a34a"></div>
        <div class="color-dot" data-color="#f59e0b"></div>
        <div class="color-dot" data-color="#ef4444"></div>
        <div class="color-dot" data-color="#8b5cf6"></div>
      </div>

      <button class="sheet-submit" onclick="submitHabitSheet()">
        Add Habit
      </button>

    </div>
  </div>
</div>
</body>

</html>