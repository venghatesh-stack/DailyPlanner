<div id="task-{{ task.id }}"
     class="task {% if task.done %}done{% endif %}"
     data-id="{{ task.id }}"
     data-status="{{ task.status }}">

  <!-- ğŸ”¹ SUMMARY ROW (always visible) -->
  <div class="task-row task-main"
       onclick="toggleTask(this.parentElement)">

    <input type="checkbox"
           {% if task.status == "done" %}checked{% endif %}
           onclick="event.stopPropagation()"
           onchange="updateStatus('{{ task.id }}', this.checked ? 'done' : 'open')">

    <div class="task-text">
      {{ task.text }}
    </div>

    <!-- START DATE (visible always) -->
    <input type="date"
           class="start-date"
           value="{{ task.start_date or '' }}"
           onclick="event.stopPropagation()"
           oninput="updatePlanning('{{ task.id }}')">
  </div>

  <!-- ğŸ”½ EXPANDED SECTION (hidden by default) -->
  <div class="task-details">

    <!-- Planning -->
    <div class="task-row task-meta">
      <label>Duration</label>
      <input type="number"
             class="duration-days"
             min="0"
             max="999"
             Step="0.5"
             value="{{ task.duration_days or 0 }}"
             oninput="updatePlanning('{{ task.id }}')">
      <span>days</span>

      <label>Due</label>
      <span class="due-date">{{ task.due_date }}</span>

      <select onchange="updateDueTime('{{ task.id }}', this.value)">
        {% for h in range(0,24) %}
          <option value="{{ "%02d:00"|format(h) }}"
            {% if task.due_time == "%02d:00"|format(h) %}selected{% endif %}>
            {{ "%02d:00"|format(h) }}
          </option>
        {% endfor %}
      </select>

      <label>Status</label>
      <select onchange="updateStatus('{{ task.id }}', this.value)">
        <option value="open" {% if task.status=='open' %}selected{% endif %}>Open</option>
        <option value="in_progress" {% if task.status=='in_progress' %}selected{% endif %}>In Progress</option>
        <option value="done" {% if task.status=='done' %}selected{% endif %}>Done</option>
      </select>
    </div>

    <!-- Delegation -->
    <div class="meta">
      ğŸ‘¤ Delegate to:
      <input type="text"
             value="{{ task.delegated_to or '' }}"
             onchange="updateDelegation('{{ task.id }}', this.value)">
    </div>

    <!-- Elimination -->
    <div class="meta">
      ğŸ—‘ Elimination reason:
      <textarea
        rows="1"
        maxlength="250"
        class="auto-grow"
        placeholder="Reason (optional)"
        onchange="updateElimination('{{ task.id }}', this.value)"
        >{{ task.elimination_reason or '' }}</textarea>

    </div>

    <!-- Time tracking -->
    <div class="meta">
      â³ Planned hours:
      <input type="number"
             min="0"
             max="999"
             step="0.5"
             value="{{ task.planned_hours or 0 }}"
             onchange="updatePlanned('{{ task.id }}', this.value)">
    </div>

    <div class="meta">
      âœ… Actual hours:
      <input type="number"
             min="0"
             max="999"
             step="0.5"
             value="{{ task.actual_hours or 0 }}"
             onchange="updateActual('{{ task.id }}', this.value)">
    </div>

    <!-- Delete -->
    <button class="icon-btn danger"
            onclick="eliminateTask('{{ task.id }}')">
      ğŸ—‘ Delete task
    </button>

  </div>
</div>
<div id="task-{{ task.id }}"
     class="task {% if task.done %}done{% endif %}"
     data-id="{{ task.id }}"
     data-status="{{ task.status }}">

  <!-- ğŸ”¹ SUMMARY ROW (always visible) -->
  <div class="task-row task-main"
       onclick="toggleTask(this.parentElement)">

    <input type="checkbox"
           {% if task.status == "done" %}checked{% endif %}
           onclick="event.stopPropagation()"
           onchange="updateStatus('{{ task.id }}', this.checked ? 'done' : 'open')">

    <div class="task-text">
      {{ task.text }}
    </div>

    <!-- START DATE (always visible, compact) -->
    <input type="date"
           class="start-date"
           value="{{ task.start_date or '' }}"
           onclick="event.stopPropagation()"
           oninput="updatePlanning('{{ task.id }}')">
  </div>

  <!-- ğŸ”½ EXPANDED SECTION -->
  <div class="task-details">

    <!-- ğŸ“… PLANNING -->
    <div class="task-section">
      <div class="task-section-title">Planning</div>

      <div class="task-row task-meta">
        <label>Duration</label>
        <input type="number"
               class="duration-days"
               min="1"
               value="{{ task.duration_days or 1 }}"
               oninput="updatePlanning('{{ task.id }}')">
        <span>days</span>

        <label>Due</label>
        <span class="due-date">{{ task.due_date }}</span>

        <select onchange="updateDueTime('{{ task.id }}', this.value)">
          {% for h in range(0,24) %}
            <option value="{{ "%02d:00"|format(h) }}"
              {% if task.due_time == "%02d:00"|format(h) %}selected{% endif %}>
              {{ "%02d:00"|format(h) }}
            </option>
          {% endfor %}
        </select>

        <label>Status</label>
        <select onchange="updateStatus('{{ task.id }}', this.value)">
          <option value="open" {% if task.status=='open' %}selected{% endif %}>Open</option>
          <option value="in_progress" {% if task.status=='in_progress' %}selected{% endif %}>In Progress</option>
          <option value="done" {% if task.status=='done' %}selected{% endif %}>Done</option>
        </select>
      </div>
    </div>

    <!-- ğŸ‘¤ OWNERSHIP -->
    <div class="task-section">
      <div class="task-section-title">Ownership</div>
      <div class="meta">
        ğŸ‘¤ Delegate to:
        <input type="text"
               value="{{ task.delegated_to or '' }}"
               onchange="updateDelegation('{{ task.id }}', this.value)">
      </div>
    </div>

    <!-- â± TRACKING -->
    <div class="task-section">
      <div class="task-section-title">Tracking</div>

      <div class="meta">
        â³ Planned hours:
        <input type="number"
               min="0"
               step="0.5"
               value="{{ task.planned_hours or 0 }}"
               onchange="updatePlanned('{{ task.id }}', this.value)">
      </div>

      <div class="meta">
        âœ… Actual hours:
        <input type="number"
               min="0"
               step="0.5"
               value="{{ task.actual_hours or 0 }}"
               onchange="updateActual('{{ task.id }}', this.value)">
      </div>
    </div>

    <!-- ğŸ—‘ ELIMINATION -->
    <div class="task-section">
      <div class="task-section-title">Elimination</div>
      <div class="meta">
        ğŸ—‘ Reason:
        <input type="text"
               value="{{ task.elimination_reason or '' }}"
               onchange="updateElimination('{{ task.id }}', this.value)">
      </div>

      <button class="icon-btn danger"
              onclick="eliminateTask('{{ task.id }}')">
        ğŸ—‘ Delete task
      </button>
    </div>

  </div>
</div>
