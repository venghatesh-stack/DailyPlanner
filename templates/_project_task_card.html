

<div id="task-{{ task.id }}"
     class="task {% if task.done %}done{% endif %}"
     data-id="{{ task.id }}"
     data-status="{{ task.status }}">

<!-- ðŸ”¹ SUMMARY ROW (always visible) -->
<div class="task-row task-main"
     onclick="toggleTask('{{ task.task_id }}')">

  <input type="checkbox"
         {% if task.status == "done" %}checked{% endif %}
         onclick="event.stopPropagation()"
         onchange="updateStatus('{{ task.task_id }}', this.checked ? 'done' : 'open')">
  <span class="priority-icon"
        data-priority="{{ task.priority }}"
        onclick="cyclePriority(event, '{{ task.task_id }}')"
        title="Change priority">
  </span>

<div class="task-text">
  <span class="task-title">{{ task.task_text}}</span>

  {% if task.due_date %}
    <span class="due-badge {% if task.due_date < today %}overdue{% endif %}">
      ðŸ“… {{ task.due_date }}
    </span>
  {% endif %}
</div>


</div>



  <!-- ðŸ”½ EXPANDED SECTION -->
  <div class="task-details">

    <!-- ROW 1: PLANNING / STATUS -->
    <div class="task-row task-details-row planning-row">
       <div class="field">
    <label>Start</label>
  <input type="date"
       class="start-date"
       value="{{ task.start_date or '' }}"
       oninput="updatePlanning('{{task.task_id }}')">


    </div>
      <div class="field">
        <label>Duration</label>
        <input type="number"
               class="duration-days"
               min="0"
               max="999"
               value="{{ task.duration_days or 0 }}"
               oninput="updatePlanning('{{ task.task_id }}')">
      </div>

      <div class="field">
        <label>Planned</label>
        <input type="number"
               min="0"
               max="999"
               step="0.5"
               value="{{ task.planned_hours or 0 }}"
               onchange="updatePlanned('{{ task.task_id }}', this.value); updateProgress('{{ task.id }}')">
      </div>

      <div class="field">
        <label>Actual</label>
        <input type="number"
               min="0"
               max="999"
               step="0.5"
               value="{{ task.actual_hours or 0 }}"
               onchange="updateActual('{{ task.task_id }}', this.value); updateProgress('{{ task.id }}')">
      </div>


      <div class="field">
        <select onchange="updateDueTime('{{ task.task_id }}', this.value)">
          {% for h in range(0,24) %}
            <option value="{{ "%02d:00"|format(h) }}"
              {% if task.due_time == "%02d:00"|format(h) %}selected{% endif %}>
              {{ "%02d:00"|format(h) }}
            </option>
          {% endfor %}
        </select>
      </div>

      <div class="field">
        <select onchange="updateStatus('{{ task.task_id }}', this.value)">
          <option value="open" {% if task.status=='open' %}selected{% endif %}>Open</option>
          <option value="in_progress" {% if task.status=='in_progress' %}selected{% endif %}>In Progress</option>
          <option value="done" {% if task.status=='done' %}selected{% endif %}>Done</option>
        </select>
      </div>
    </div>

    <!-- ROW 2: ACTIONS -->
    <div class="task-row task-details-row action-row">

      <div class="field wide">
        <label>Delegate</label>
        <input type="text"
               maxlength="25"
               value="{{ task.delegated_to or '' }}"
               onchange="updateDelegation('{{ task.task_id }}', this.value)">
      </div>

      <div class="field wide">
        <label>Elimination reason</label>
        <textarea rows="1"
                  maxlength="25"
                  oninput="this.style.height='auto';this.style.height=this.scrollHeight+'px'"
                  onchange="updateElimination('{{ task.task_id }}', this.value)">{{ task.elimination_reason or '' }}</textarea>
      </div>
      <div class="task-actions">
            <button class="save-task-btn">ðŸ’¾ Save</button>
      </div>
      <button class="icon-btn danger"
              onclick="eliminateTask('{{ task.task_id }}')">
        ðŸ—‘ Delete
      </button>
    </div>

  </div>
</div>
