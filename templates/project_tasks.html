<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ project.name }}</title>

  <!-- Global stylesheet -->
  <link rel="stylesheet" href="{{ url_for('static', filename='project_tasks.css') }}">
</head>

<body>

  <!-- Top Navigation -->
  {% include "_top_nav.html" %}

  <div class="container">

    <!-- Header -->
    <div class="header">
      <a href="/projects" class="back">‚Üê Projects</a>
      <h2>{{ project.name }}</h2>
    </div>

    <!-- Add Task -->
    <div class="add-box">
      <form method="post" action="/projects/{{ project.project_id }}/tasks/add">
        <input
          name="task_text"
          placeholder="Add a clear, actionable task‚Ä¶"
          autocomplete="off"
          required
        />

        <input
          type="date"
          name="start_date"
          value="{{ selected_date }}"
        >

        <button type="submit">Add</button>
      </form>
    </div>

    <!-- Filters -->
    <div class="task-filters">
      <label class="filter">
        <input type="checkbox" id="hideClosed" checked>
        Hide closed
      </label>

      <label class="filter">
        <input type="checkbox" id="showOverdueOnly">
        Overdue only
      </label>
    </div>
<!-- Voice Dictation -->
<div class="voice-box">
  <button
    type="button"
    class="voice-btn"
    onclick="toggleVoice('projectNotes', 'voiceStatus')">
    üéô Dictate tasks
  </button>

  <div id="voiceStatus" class="voice-status">
    Tap mic and start speaking
  </div>
</div>


    <!-- Project Notes -->
    <div class="project-notes">
      <textarea
        id="projectNotes"
        data-project-id="{{ project.project_id }}"
        placeholder="‚Ä¢ Capture thoughts here‚Ä¶"
        rows="6"></textarea>

      <div style="margin-top:8px; text-align:right;">
        <button
          id="addTasksFromNotes"
          class="save-task-btn">
          ‚ûï Add as Tasks
        </button>
      </div>
    </div>

    <!-- Project Health -->
    <div id="project-health" class="project-health">
      <div class="health-score">
        <div class="score-value" id="health-score">‚Äî</div>
        <div class="score-label">Health ¬∑ {{ project.name }}</div>
      </div>

      <div class="health-metrics">
        <div><strong id="metric-complete">0%</strong><span>Complete</span></div>
        <div><strong id="metric-overdue">0</strong><span>Overdue</span></div>
        <div><strong id="metric-accuracy">0%</strong><span>Accuracy</span></div>
        <div><strong id="metric-progress">0</strong><span>In Progress</span></div>
      </div>
    </div>

    <!-- Sort -->
    <select
      id="sortSelect"
      data-project-id="{{ project.project_id }}">
      <option value="smart">Smart</option>
      <option value="due">Due</option>
      <option value="priority">Priority</option>
      <option value="created">Created</option>
    </select>

    <!-- Task Groups -->
    {% for group, tasks in grouped_tasks.items() %}
      <div class="task-group">

        <h3 class="group-title">
          {{ group }}
          <span class="count">{{ tasks|length }}</span>
        </h3>

        {% if tasks %}
          {% for task in tasks %}
            {% include "_project_task_card.html" %}
          {% endfor %}
        {% else %}
          <div class="empty">No tasks</div>
        {% endif %}

      </div>
    {% endfor %}

  </div>

  <!-- ‚úÖ ONE JS ENTRY POINT -->
  <script
    src="{{ url_for('static', filename='project_tasks.js') }}"
    defer>
  </script>

  <!-- Voice (kept separate on purpose) -->
  <script src="{{ url_for('static', filename='voice.js') }}"></script>
  <script>
    initVoiceDictation("projectNotes", "voiceStatus");
  </script>

</body>
</html>
