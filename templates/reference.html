<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet"
        href="{{ url_for('static', filename='references.css') }}">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@yaireo/tagify/dist/tagify.css">
  <script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify"></script>
</head>
<body>
 
<div class="reference-container">
  <div class="nav-icons">  {% include "_top_nav.html" %}  </div>
  <!-- ðŸ” SEARCH / FILTER -->
  <div class="reference-search">
    <form method="GET">
      <input type="text"
             name="tag"
             placeholder="Search by tag"
             value="{{ request.args.get('tag','') }}">

      <select name="category">
        <option value="">All Categories</option>
        <option value="Technology"
          {% if request.args.get('category') == 'Technology' %}selected{% endif %}>
          Technology
        </option>
        <option value="Health"
          {% if request.args.get('category') == 'Health' %}selected{% endif %}>
          Health
        </option>
        <option value="Finance"
          {% if request.args.get('category') == 'Finance' %}selected{% endif %}>
          Finance
        </option>
        <option value="Learning"
          {% if request.args.get('category') == 'Learning' %}selected{% endif %}>
          Learning
        </option>
      </select>

      <button type="submit">Search</button>
    </form>
  </div>
<div class="ai-toggle">
  <label class="ai-toggle-label">
    <input type="checkbox" id="enable-ai" checked>
    <span>Enable AI Assist (Gemini)</span>
  </label>
  <small class="ai-note">
    When enabled, title, tags and category are auto-generated.
  </small>
</div>
<!-- ðŸ¤– AI ASSIST -->
<div class="ai-assist-card">

  <div class="ai-header">
    <h3>ðŸ¤– AI Assist</h3>

    <select id="ai-mode">
      <option value="api">API Mode (Auto Generate)</option>
      <option value="manual">Manual (ChatGPT)</option>
    </select>
  </div>

  <div class="question-input-wrapper">
    <input type="text"
           id="ai-query"
           placeholder="Ask AI something..." />
    <button type="button" id="voiceBtn">ðŸŽ™</button>
  </div>

  <div class="ai-buttons">
    <button id="ai-primary-btn">Generate</button>
  </div>

  <div id="ai-preview" class="ai-preview"></div>

</div>
 <div id="resultCount"></div>
<div id="tagCloud" class="tag-cloud"></div>
  <!-- âž• ADD NEW REFERENCE -->
  <div class="reference-card">

    <input type="text"
           id="ref-title"
           placeholder="Title (optional)" />

    <textarea id="ref-description"
              placeholder="Brief description..."></textarea>

    <input type="url"
           id="ref-url"
           placeholder="https://example.com"
           required />

    <input type="text"
           id="ref-tags"
           placeholder="tags (comma separated)" />

  <select id="ref-category">
  <option value="">Select Category</option>

  {% for cat in categories %}
    <option value="{{ cat }}">{{ cat }}</option>
  {% endfor %}
</select>

<!-- Optional: Allow custom category -->
<input type="text"
       id="new-category"
       placeholder="Or enter new category">
    <button type="button" id="saveRefBtn">Save</button>
  </div>

<div class="filter-bar">

  <button id="resetFilterBtn">All</button>

  <input type="text" id="searchInput" placeholder="Search references...">

  <select id="sortSelect">
    <option value="created_at_desc">Newest</option>
    <option value="created_at_asc">Oldest</option>
    <option value="title_asc">Title A-Z</option>
  </select>

</div>
  <!-- ðŸ“š RESULTS -->
  <div id="referenceList" class="reference-list">

    {% if references %}
      {% for ref in references %}
        <div class="ref-item">

          <h4>
            <a href="{{ ref.url }}" target="_blank">
              {{ ref.title or ref.url }}
            </a>
          </h4>

          {% if ref.description %}
            <p class="ref-desc">{{ ref.description }}</p>
          {% endif %}

          <div class="ref-meta">

            {% if ref.tags %}
              {% for tag in ref.tags %}
                <a href="/references?tag={{ tag }}"
                   class="tag">
                  {{ tag }}
                </a>
              {% endfor %}
            {% endif %}

            {% if ref.category %}
              <span class="category">
                {{ ref.category }}
              </span>
            {% endif %}

          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="empty-state">
        No references found.
      </div>
    {% endif %}

  </div>

</div>
<div id="toast-container"></div>
<script src="{{ url_for('static', filename='references.js') }}" defer></script>
<script src="{{ url_for('static', filename='js/ai_assist.js') }}" defer></script>

</body>
</html>  
